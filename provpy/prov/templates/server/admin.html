{# Copyright (C) 2011 University of Southampton #}
{% extends "base.html" %}
{% load url from future %}
{% load guardian_tags %}
{% block content %}
<script type="text/javascript">
var userTags = [{% for u in all_users %}"{{ u }}" {% if not forloop.last %},{% endif %}{% endfor %}];
var groupTags = [{% for g in all_groups %}"{{ g }}" {% if not forloop.last %},{% endif %}{% endfor %}];
jQuery(function($) {
  $('div.btn-group[data-toggle-name=*]').each(function(){
    var group   = $(this);
    var form    = group.parents('form').eq(0);
    var name    = group.attr('data-toggle-name');
    var hidden  = $('input[name="' + name + '"]', form);
    $('button', group).each(function(){
      var button = $(this);
      button.live('click', function(){
          hidden.val($(this).val());
          if($(this).val() == "user"){
          		$( "#name_add" ).autocomplete({
					source: userTags
				});
          }
          else {
          		$( "#name_add" ).autocomplete({
					source: groupTags
				});
          }
      });
      if(button.val() == hidden.val()) {
        button.addClass('active');
      }
    });
  });
});
$(function() {
		$( "#name_add" ).autocomplete({
			source: userTags
		});
	});
</script>	
      	<div class="span3">
        	<h2>Bundle {{ bundle.rec_id }}</h2>
        	</br>
        	<h4>Currently the bundle is {% if public %}Public.{% else %}Private.{% endif %}</h4>
        	<form class="form-inline" action="{% url 'server.views.admin_bundle' bundle.id %}" method="post">
         	{% csrf_token %}
         	<button type="submit" value="submit" class="btn btn-info">
          	Make {% if public %}Private{% else %}Public{% endif %}</button>  
         	<input type="hidden" name="name" value="public" />
         	<input type="hidden" name="type" value="group" />  
         	<input type="hidden" name="role" value="{% if public %}none{% else %}Reader{% endif %}" />
         	</form>
        </div>
        <span class="span6">
        <form class="form-horizontal" action="{% url 'server.views.admin_bundle' bundle.id %}" method="post">
         	{% csrf_token %}
         	<div class="control-group">  
            	<div class="controls"> 
            	    <h3>Add New</h3> 
					<div class="btn-group" data-toggle-name="type" data-toggle="buttons-radio" >
					  <button type="button" value="user" class="btn" data-toggle="button">User</button>
					  <button type="button" value="group" class="btn" data-toggle="button">Group</button>
					</div>
					<input type="hidden" name="type" value="user" />
					<input type="text" class="input-xlarge span2" name="name" id="name_add">
					<select name="role" style="width:120px">
					    <option>Administrator</option>   
		                <option>Editor</option>   
		                <option>Contributor</option>  
		                <option>Reader</option>   
                 	</select>
                	<button type="submit" value="submit" class="btn btn-primary">Add</button>
                	{% if message %}
					<h3>{{ message }}</h3>
					{% endif %}  	
          		</div>
          	</div>      
          </form>
      </span>
      <span class="span2">
      <a class="btn btn-primary pull-right" onClick="go_to('/prov/home');">Back</a>
      </span>
<span class="span11">
      <table class="table">  
        <thead>  
          <tr><th><h3>Owner</h3></th></tr>  
        </thead>  
        <tbody>  
          <tr><td>{{ bundle.owner }}</td></tr>  
        </tbody>  
      </table>
{% include 'server/perm_table.html' with op1='Administrator' op2='Editor' op3='Contributor' op4='Reader' desc='All permissions' p_number=4 %}
{% include 'server/perm_table.html' with op1='Editor' op2='Administrator' op3='Contributor' op4='Reader' desc='Read,Write and Delete' p_number=3 %}
{% include 'server/perm_table.html' with op1='Contributor' op2='Administrator' op3='Editor' op4='Reader' desc='Read and Write' p_number=2 %}
{% include 'server/perm_table.html' with op1='Reader' op2='Administrator' op3='Editor' op4='Contributor' desc='Read only' p_number=1 %}
</span>
{% endblock %}
